"use strict";!function(){function e(a){var o=this,c="selected";function n(e,t){return _.get(o.reference,[e,t],"--")}function r(e,t){return _.get(o.context,[e,t],"--")}function i(e,t){return r(e,t)===n(e,t)}function s(e){var t=o.reference,i=e.key,n=_.get(e.schema,"c8y_JsonSchema"),r=_.reduce(n.properties,function(e,t,n){var r=!_.isUndefined(_.get(o.reference,[i,n]));if(!function(e){var t=!0;if("operations"!==e.type){if(t=function(e){return _.keys(e).map(function(e){return e.toLowerCase()}).includes("readonly")}(e)){var n=_.map(e.operations,"name").map(function(e){return e.toLowerCase()});t=!_.includes(n,"write")}}return t}(t)&&r){var c=_.clone(t);c.key=n,c.schemaMatchKey=i,e[n]=c}return e},{});if(!Object.keys(r).length)return null;var c=n.titleDisplay?a.replaceObjectPlaceholders(n.titleDisplay,t,e.key):n.title;return _.assign({title:c,properties:r,closed:!0},e)}function e(e){var t=e.properties;return!o.hideSynced||_.some(t,u)}function u(e){var t=e.schemaMatchKey,n=e.key;return!o.hideSynced||!i(t,n)}function f(){var r=[],e=o.schemaMatches;return _.forEach(e,function(t){var n=!0;_.forEach(t.properties,function(e){i(t.key,e.key)||(n&&(n=!1),r.push(e))}),n||r.push(t)}),r}function l(){var e=f(),t=_.every(e,c),n=_.filter(e,c),r=_.difference(e,n);o.onSelect({allSelected:t,selected:n,notSelected:r})}function h(e){return _.filter(e.properties,function(e){return i(e.schemaMatchKey,e.key)}).length}_.assign(o,{$onChanges:function(e){(e.reference||e.schemas)&&o.reference&&o.schemas&&function(){var e=a.matchObjectWithSchemas(o.reference,o.schemas);o.schemaMatches=_.sortBy(_.filter(e.map(s)),"title");var t=o.schemaMatches;o.onSchemaMatch({matches:t}),l()}();e.selectAll&&function(t){var e=f();if(!1===t&&_.some(e,function(e){return!e[c]}))return;f().forEach(function(e){return _.set(e,c,t)}),l()}(o.selectAll)},getValueReference:n,getValueContext:r,valuesMatch:i,allValuesMatch:function(t){return _.every(t.properties,function(e){return i(t.key,e.key)})},fragmentExistsInContext:function(e){return!!_.get(o.context,e)},isPropertyVisible:u,isSchemaMatchVisible:e,countSyncedProperties:h,countUnsyncedProperties:function(e){var t=e.properties;return Object.keys(t).length-h(e)},updateSelectAll:l,onSelectChangeMatchSchema:function(e){var t=e[c],n=_.filter(e.properties,function(e){return!i(e.schemaMatchKey,e.key)});_.forEach(n,function(e){return _.set(e,c,t)}),l()},onSelectChangeProperty:function(e){var t=e.schemaMatchKey,n=_.find(o.schemaMatches,function(e){return e.key===t}),r=_.filter(n.properties,function(e){return!i(e.schemaMatchKey,e.key)});n[c]=_.every(r,c),l()},allSynced:function(){return o.matches&&_.every(o.matches,e)},SELECTED:c})}e.$inject=["c8yGenericUi"],angular.module("c8y.configAudit").component("c8yConfigAuditDiff",{templateUrl:":::PLUGIN_PATH:::/config-audit/config-audit-diff.html",controllerAs:"vm",controller:e,bindings:{context:"<",schemas:"<",reference:"<",onSchemaMatch:"&",hideSynced:"<",selectAll:"<",onSelect:"&"}})}();
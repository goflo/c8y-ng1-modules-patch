"use strict";angular.module("c8y.deviceNetwork").controller("deviceNetworkCtrl",["$scope","c8yBase","c8yDeviceControl","c8ySettings","c8yAlert","gettext",function(t,e,r,n,a,s){var i=[{value:"pap",label:"PAP"},{value:"chap",label:"CHAP"},{value:"none",label:s("None")}],o=[{substr:{start:0,count:1},leadingBits:"0",netmask:"255.0.0.0"},{substr:{start:0,count:2},leadingBits:"10",netmask:"255.255.0.0"},{substr:{start:0,count:3},leadingBits:"110",netmask:"255.255.255.0"}];function c(e){return _.isBoolean(e)?e:Boolean(e)}function u(e,t){var n=e.c8y_Network.c8y_WAN,a={deviceId:e.id,description:s("Configure WAN settings"),deliveryType:t,c8y_Network:{c8y_WAN:{apn:n.apn,username:n.username,password:n.password,authType:n.authType}}};return r.create(a).then(_.partial(d,s("Sent operation to apply WAN settings.")))}function d(e){a.success(e)}function l(e){var t;if(e){var n=e.split("."),a=p(parseInt(n[0],10).toString(2),8);t=null,_.forEach(o,function(e){a.substr(e.substr.start,e.substr.count)===e.leadingBits&&(t=e.netmask)})}return t}function p(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"0",a="".concat(e);return a.length>=t?a:new Array(t-a.length+1).join(n)+a}t.patterns={MAC:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/},t.authTypes=i,t.invalid=angular.bind(e,e.invalid,t),t.onLanIpChanged=function(e){e.netmask=l(e.ip)},t.saveWANviaIP=function(e){return u(e)},t.saveWANviaSMS=function(e){return u(e,"SMS")},t.saveLAN=function(e){var t=e.c8y_Network.c8y_LAN,n={deviceId:e.id,description:s("Configure LAN settings"),c8y_Network:{c8y_LAN:{enabled:t.enabled?1:0,ip:t.ip,netmask:t.netmask}}};r.create(n).then(_.partial(d,s("Sent operation to apply LAN settings.")))},t.saveDHCP=function(e){var t=e.c8y_Network.c8y_DHCP,n={deviceId:e.id,description:s("Configure DHCP settings"),c8y_Network:{c8y_DHCP:{enabled:t.enabled?1:0,addressRange:t.addressRange,dns1:t.dns1,dns2:t.dns2,domainName:t.domainName}}};r.create(n).then(_.partial(d,s("Sent operation to apply DHCP settings.")))},t.$watch("device",function(e){_.update(e,"c8y_Network.c8y_LAN.enabled",c),_.update(e,"c8y_Network.c8y_DHCP.enabled",c)}),n.getSystemOptionValue({category:"messaging",key:"provider"},!1).then(function(e){t.smsEnabled=!!e})}]);
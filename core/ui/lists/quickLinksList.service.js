"use strict";!function(){function e(d,g,v,y,e,f,h){var E;return{list:function(){return d.all({nbDevices:0,currentApp:e.getCurrent(),buildTarget:d.resolve(v.appOption("target")),userApps:e.listByUser().then(n)}).then(function(e){var i=_.get(e,"currentApp.name"),n=e.nbDevices,r=e.buildTarget;E=e.userApps;var c=[],o=function(n){return y.hasAnyRole(["ROLE_USER_MANAGEMENT_CREATE","ROLE_USER_MANAGEMENT_ADMIN"]).then(function(e){return e&&m("administration")}).then(function(e){return e?_.assign({priority:2,icon:"c8y-icon c8y-icon-add-user",label:f("Add user"),url:"/apps/administration/index.html#/users/new",color:"#FEFEFE",backgroundColorClass:C("a")},n):null})}(),t=function(e){var n;m("devicemanagement")&&(n=_.assign({priority:2,icon:"c8y-icon c8y-icon-device-connect",label:f("Add device"),url:"/apps/devicemanagement/#/deviceregistration",color:"#FEFEFE",backgroundColorClass:C("b")},e));return n}(),a=function(e){var n;if(h){var i={dt:{backgroundColorClass:C("d")}};if(m("devicemanagement")){var r=(i[e]||{}).backgroundColorClass||"e";n={priority:2,icon:"c8y-icon c8y-icon-group-add",label:f("Add group"),click:k,color:"#FEFEFE",backgroundColorClass:C(r)}}}return n}(r),u=function(e){return{priority:({dt:{priority:2}}[e]||{}).priority||3,icon:"c8y-icon c8y-icon-device-management",label:f("Device management"),url:"/apps/devicemanagement",color:"#EFEFEF",backgroundColorClass:C("f")}}(r),l=function(e){return{priority:({dt:{priority:2}}[e]||{}).priority||3,icon:"c8y-icon c8y-icon-cockpit",label:f("Cockpit"),url:"/apps/cockpit",color:"#EFEFEF",backgroundColorClass:C("e")}}(r),s={priority:2,iconSrc:":::PLUGIN_PATH:::/icons/HelpAndService.svg",label:f("Help & Service"),url:"/apps/HelpAndService",color:"#EFEFEF",backgroundColorClass:C("f")};if(0===n)t.priority=1;else if(n<=5){var p=1===n?1:3;c.push(g.list({pageSize:n}).then(function(e){var n=[];return _.forEach(e,function(e){n.push(function(e,n,i,r){var c,o=_.filter(["cockpit","devicemanagement"],function(e){return m(e)});if(o.length){var t=_.includes(o,r)?r:_.head(o);c=_.assign({priority:({dt:{priority:2}}[i]||{}).priority||3,icon:"c8y-icon c8y-icon-device",label:e.name||f("Device ")+e.id,url:"/apps/".concat(t,"/#/device/").concat(e.id),color:"#FEFEFE",backgroundColorClass:C("c")},n)}return c}(e,{priority:p},r,i))}),n}))}else l.priority=1;return c.push(function(){var e,n=v.getPluginService("phoneRegistrationService");n&&(e=n.createAddPhoneLink());return e}()),c.push(d.when(o)),c.push(d.when(t)),c.push(d.when(a)),"devicemanagement"!==i&&m("devicemanagement")&&c.push(d.when(u)),"cockpit"!==i&&m("cockpit")&&c.push(d.when(l)),"HelpAndService"!==i&&"dt"===r&&m("HelpAndService")&&c.push(d.when(s)),d.all(c).then(_.flattenDeep).then(_.partialRight(_.filter,_.identity))})}};function k(){h.addAssetUI()}function m(e){return _.includes(E,e)}function C(e){return["quick-link","quick-link-".concat(e.priority),"quick-link-bgcolor-".concat(e.backgroundColorClass)]}function n(e){return _(e).map("contextPath").uniq().value()}}e.$inject=["$q","c8yDevices","c8yBase","c8yPermissions","c8yApplication","gettext","groupsHierarchySvc"],angular.module("c8y.ui").factory("c8yQuickLinks",e)}();
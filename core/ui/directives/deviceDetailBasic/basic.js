"use strict";!function(){function e(m,f,p,g,h,b,w,A,I){return{link:function(a){var n,i,t=null,c=null,r=60;function s(e){return p.detail(e).then(g.getResData).then(function(e){a.device=e,a.originalDevice=_.cloneDeep(a.device)})}function o(e){l(e&&e.c8y_RequiredAvailability),e.owner&&f.hasRole(c,"ROLE_USER_MANAGEMENT_READ")&&function(e){f.detail(e,!0).then(d,v)}(e.owner),function(e,n){e&&n&&f.isDeviceUser({id:n})?b.canAdminMOs([e],n).then(function(e){a.canActivateDevice=e}):a.canActivateDevice=!1}(e,e.owner)}function l(e){var n=e&&0!==e.responseInterval;a.display.responseInterval=n?Math.abs(Number(e.responseInterval)):void 0}function d(e){a.owner=e.data}function v(e){a.ownerError=e.data.message}function u(e,n){var i=_.get(a,"device.id");if(i){var t={enabled:n};m.put("/inventory/managedObjects/".concat(i,"/user"),t,{headers:{Accept:"application/json","Content-Type":"application/vnd.com.nsn.cumulocity.managedObjectUser+json;charset=UTF-8;ver=0.9"}}).then(_.partial(o,a.device))}}function y(){h.success(w("Changes saved.")),a.infoForm.$setPristine()}a.display={},a.hideOwner=function(e){return!!(-1<["demo","dg"].indexOf(t)&&e&&c.userName!==e.owner)},a.switchMaintenance=function(e){return p.switchResponseInterval(e).then(_.partial(s,e.id))},a.activate=function(e){u(0,!0)},a.deactivate=function(e){u(0,!1)},a.canActivateDevice=!1,a.save=function(e){!function(e){if(e.c8y_RequiredAvailability=e.c8y_RequiredAvailability||{},!(e.c8y_RequiredAvailability&&e.c8y_RequiredAvailability.responseInterval<0)){if(_.isNumber(Number(a.display.responseInterval))){var n,i=Math.round(a.display.responseInterval);e.c8y_RequiredAvailability.responseInterval=i,e.c8y_Tracking&&e.c8y_Tracking.interval&&e.c8y_Tracking.interval!==i*r&&(n=e.c8y_Tracking.interval>i*r?w("Changing this value can cause showing false offline statuses and prevent alarms from being created as early as possible"):w("Changing this value can cause showing false online statuses and prevent alarms from being created as early as possible"),h.add({text:n,type:"warning"}))}else e.c8y_RequiredAvailability.responseInterval=0;l(e.c8y_RequiredAvailability)}}(e),function(e,n){return n.c8y_Mobile&&e&&e.c8y_Mobile&&n.c8y_Mobile.iccid!==e.c8y_Mobile.iccid&&n.c8y_Mobile.c8y_IsConnectivity}(a.originalDevice,e)&&delete e.c8y_Mobile.c8y_IsConnectivity,p.save(e).then(_.partial(s,e.id)).then(y),A.changeTitle({title:p.properName(e)}),function(e){var n=I.findNode(function(n){return function(e){return _.get(e,"device.id")===n.id}}(e));n&&(n.name=p.properName(e))}(e)},a.showTerritory="cchdemo"===_.merge({},window.C8Y_APP&&window.C8Y_APP.C8Y_INSTANCE_OPTIONS,window.C8Y_INSTANCE_OPTIONS).target,n=a.$watch("device",function(e){e&&e.type&&n(),p.isVendme(e)&&(e.c8y_Hardware={model:e.com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.model,serialNumber:e.com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial,revision:""},a.$watch("device.c8y_Hardware",function(e){a.device.com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.model=e.model,a.device.com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial=e.serialNumber},!0))}),i=a.$watch("device",function(e){e&&e.type&&i(),p.isVendme(e)&&(e.c8y_Mobile={imei:e.com_nsn_startups_vendme_fragments_VendingMachineInfo.imei},a.$watch("device.c8y_Mobile",function(e){a.device.com_nsn_startups_vendme_fragments_VendingMachineInfo.imei=e.imei},!0))}),f.current().then(function(e){t=(c=e).tenant,a.$watch("device",o)})},restrict:"E",scope:{device:"="},templateUrl:":::PLUGIN_PATH:::/ui/views/deviceDetailBasic/basic.html"}}e.$inject=["$http","c8yUser","c8yDevices","c8yBase","c8yAlert","c8yPermissions","gettext","c8yTitle","c8yNavigator"],angular.module("c8y.ui").directive("c8yDeviceDetailBasic",e)}();
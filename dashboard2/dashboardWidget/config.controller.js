"use strict";!function(){function e(s,e,t,o,n,i,a,c,d,g){var l,r=_.cloneDeep(n),p=_.cloneDeep(i),f=new Map;function m(e){s.components=e,s.data.cmp=function(t){return _.find(s.components,function(e){return e.name===t.name})}(i)}s.cancel=function(){s.$broadcast("cancelWidget"),e.dismiss()},s.save=function(){p.config=s.config,s.$broadcast("saveWidget"),e.close(p)},s.data={},s.component=p,s.dashboard=r,s.config=p.config||{},s.title=p.id?c("Edit widget"):c("Create widget"),s.noNewWidgets=function(e){return!(e.options&&e.options.noNewWidgets)},s.orderWidgets=function(e){return e.nameDisplay||e.name},s.hideTarget=a,s.targetNotSelectedValidation=function(){return!(_.get(s,"componentOptions.noDeviceTarget")||_.get(s,"componentOptions.deviceTargetNotRequired")||_.get(s,"config.device"))},s.$watch("data.cmp",function(e,t){if(e){e!==t&&(f.set(t,s.config),s.config=f.get(e)||_.cloneDeep(s.config)),s.reloadingConfigTemplate=!0,g(function(){s.reloadingConfigTemplate=!1},100),t=t||{};var n=(e=e||{}).name,o=t.name,i=d.getString(e.nameDisplay||n),a=d.getString(t.nameDisplay||o);p.name=n,p.templateUrl=e.templateUrl,p.widgetComponent=e.widgetComponent,p.configTemplateUrl=e.configTemplateUrl,p.configComponent=e.configComponent,p.componentTransformConfigWithContext=e.transformConfigWithContext,s.componentOptions=e.options||{},s.componentOptions.widgetDefaults&&_.assign(p,s.componentOptions.widgetDefaults),p.title&&p.title!==a||(p.title=i),_.isUndefined(p.col)&&(p.col=6),s.forms.componentForm.$error={}}}),s.$watch("_config.device",function(e){_.isObjectLike(e)&&(s.config.device={id:e.id,name:e.name,idPath:e.idPath})}),s._config={device:s.config.device},s.getItemDescription=function(e){return e.description||c("no description")},s.widgetHeaderClasses=o.getWidgetHeaderClasses(),s.widgetContentClasses=o.getWidgetContentClasses(),s.getApplicableDashboardClasses=o.getApplicableDashboardClasses,s.getApplicableDashboardStyles=o.getApplicableDashboardStyles,s.getApplicableWidgetClasses=o.getApplicableWidgetClasses,s.getApplicableWidgetStyles=o.getApplicableWidgetStyles,s.defaultWidgetMargins=o.getDefaultWidgetMargins(p,r),s.dashboardThemeClasses=o.getDashboardThemeClasses(),s.getPreviewClasses=function(e,t){return _.merge(o.getApplicableDashboardClasses(t),o.getApplicableWidgetClasses(e,t))},s.onOpenClose=function(e){e&&$('[name="forms.componentForm"]').find('input[type="search"]').focus()},t.list().then(m),l=o.getContext(),_.includes(["device","group"],l.context)&&(s["".concat(l.context,"Id")]=l.id,s.rootId=l.id),function(){var t=_.keys(r.widgetClasses);s.dashboardWidgetHeaderOption=_.find(s.widgetHeaderClasses,function(e){return _.includes(t,e.class)});var n=_.keys(r.classes);s.dashboardWidgetContentOption=_.find(s.widgetContentClasses,function(e){return _.includes(n,e.class.replace("panel-content-","dashboard-theme-"))}),s.showVisualConfig=!("report"===o.getContext().context)}()}e.$inject=["$scope","$uibModalInstance","c8yComponents","dashboardSvc","dashboard","component","hideTarget","gettext","gettextCatalog","$timeout"],angular.module("c8y.parts.dashboard2").controller("DashboardWidgetConfigController",e)}();
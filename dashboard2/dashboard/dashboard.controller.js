"use strict";!function(){function e(o,n,d,l,r,i,s,a,c,e){var u=l.getContext(),h="report"===u.context;function t(t){t&&(o.dashboard=t,o.children=t.children||{},o.nochildren=!_.keys(o.children).length,o.isFrozen=o.isFrozenDirective||t.isFrozen,o.dashboardLocked=l.isLocked(t),l.hasWritePermissions(t).then(function(e){(o.canUnlock=e)?o.setGlobal&&!t.global&&c.update({id:t.id,c8y_Global:{}}):(o.isFrozen=!0,t.isFrozen=!0)}),l.getContextObject().then(function(e){o.dashboardContext=e}))}function b(e){l.appendChild(o.dashboard,e).then(t)}function m(e){l.updateChild(o.dashboard,e).then(t)}function f(){var e=o.defaultChildren;e&&l.restoreDefaultChildren(o.dashboard,e,o.useContext()).then(t)}function g(){return!l.isLocked(o.dashboard)&&!o.isFrozenDirective}function p(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}o.$watch("id",function(e){e&&l.detail(e,o.useContext()).then(t)}),o.$watch("config",t),o.$watch("name",function(e){e&&(o.isNamed=!0,l.named(e,o.defaultChildren,o.useContext()).then(t))}),o.$watch("dashboardName",function(e){_.isString(e)&&(o.name=e)}),o.$watch("predefinedReadOnly",function(e){e&&(o.isPredefinedReadOnly=!0,l.detailPredefinedReadOnly(o.defaultChildren,o.useContext()).then(t))}),o.$on("c8yResetDefaultChildren",f),_.assign(o,{removeChild:function(e){l.removeChild(o.dashboard,e).then(t)},editChild:function(e){var t=l.editChildUI(e,o.dashboard);return t.then(m),t},editChildDirect:function(e){l.updateChild(o.dashboard,e).then(t)},addChild:function(){l.addChildUI(o.dashboard).then(b)},editDashboard:function(){var e=o.isNamed?{dashboardId:o.dashboard.id}:void 0;l.editCurrentDashboard(e).then(n.reload)},canEdit:function(){var e=o.isNamed,t=e&&!h;return g()&&(e||t)},canWriteToDashboard:g,canLock:function(){return g()&&!_.get(o,"dashboard.readOnly")},toggleLock:function(){var e=l.isLocked(o.dashboard)?s("Your dashboard is unlocked now."):s("Your dashboard is locked now."),t=_.partial(_.unary(a.success),e);return o.changingLock=!0,l.toggleLock(o.dashboard).then(n.reload).then(t)},isRestorable:function(){return o.isNamed&&o.defaultChildren},sendViaEmail:function(){e.send(h,u,o.dashboard)},copyDashboard:function(){l.copyDashboard(o.dashboard)},removeDashboard:function(){var e=o.dashboard,t=e.deviceType&&e.deviceTypeValue?i.getString('You are about to delete the dashboard "{{name}}" from all devices of the type "{{deviceTypeValue}}". Do you want to proceed?',e):i.getString('You are about to delete the dashboard "{{name}}". Do you want to proceed?',e),n={title:s("Delete dashboard"),body:t,status:"danger",labels:{ok:s("Delete")}},a=_.partial(l.remove,e);u.id&&r(n).then(a).then(l.clearCacheList).then(function(){d.path(l.getContextPath())})},showBar:function(){return o.dashboard&&!o.isFrozenDirective&&!o.isInMemory},lockTooltip:function(){return o.dashboardLocked?s("Unlock"):s("Lock")},restoreDefault:f,fullScreen:p,toggleFullscreen:function(){var e=document.body;p()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},isLocked:l.isLocked,getTranslatedChildTitle:function(e){return e.translateTitle||o.dashboard.translateWidgetTitle?i.getString(e.title):e.title},getApplicableDashboardClasses:l.getApplicableDashboardClasses,getApplicableDashboardStyles:l.getApplicableDashboardStyles,getApplicableWidgetClasses:l.getApplicableWidgetClasses,getApplicableWidgetStyles:l.getApplicableWidgetStyles,getApplicableWidgetHandleStyles:l.getApplicableWidgetHandleStyles}),e.isAvailable().then(function(e){o.showSendViaEmail=e})}e.$inject=["$scope","$route","$location","dashboardSvc","c8yModal","gettextCatalog","gettext","c8yAlert","c8yInventory","c8yDashboardViaEmail"],angular.module("c8y.parts.dashboard2").controller("DashboardCtrl",e)}();
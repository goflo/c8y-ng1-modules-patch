"use strict";!function(){function e(l,h,s,i,n){var u={cellHeight:80,verticalMargin:0,handle:".drag-handle",draggable:{handle:".drag-handle",scroll:!1,appendTo:"body"}};return{scope:{id:"=",name:"@",dashboardName:"@",setPageTitle:"=",predefinedReadOnly:"=",defaultChildren:"=",isFrozenDirective:"=?isFrozen",useContext:"&",setGlobal:"<"},transclude:{actions:"?actionBarMore",edit:"?editButton"},restrict:"E",templateUrl:":::PLUGIN_PATH:::/dashboard/dashboard.html",link:function(r,e){var a=$(e).find(".dashboard-container");a.gridstack(_.clone(u));var t=a.data("gridstack"),c={};function o(e,i){e&&(t.locked(i,!0),t.movable(i,!1),t.resizable(i,!1))}function d(e,i){r.$broadcast("dashboard-change"),_(i).map(function(i){var e=_.find(c,function(e){return e.widget_el&&e.widget_el.is(i.el)}),a=e&&e.scope;return r&&a.$broadcast("dashboardResize"),{child:a&&a.child,widgetData:i}}).map(function(e){var i=e.widgetData;return e.child&&(e.child._x=i.x,e.child._y=i.y,e.child._width=i.width,e.child._height=i.height),e.child}).forEach(function(e){e&&r.editChildDirect(e)})}r.$watch("dashboard",function(e){e&&(r.setPageTitle&&s.getIconNameObj(e).then(function(e){return n.changeTitle({title:e.name})}),i.addDashboard(r),r.$on("$destroy",function(){i.removeDashboard(r)}))}),r.$watch("children",function(i){var e,n=h('<c8y-dashboard-child config="child"></c8y-dashboard-child>');_.isObjectLike(i)&&(e=_.map(i,function(i){var a,d=c[i.id],t=l.defer();return d?(d.scope.child=i,t.resolve(d)):((a=r.$new()).child=i,n(a,function(e){c[i.id]={el:e,scope:a},d=c[i.id],t.resolve(d)})),t.promise}),a.off("change",d),l.all(e).then(function(){var e=_(c);e.map(function(e,i){return i}).filter(function(e){return!i[e]}).forEach(function(e){var i=c[e];t.remove_widget(i.widget_el),i.scope.$destroy(),delete c[e]}),e.filter(function(e){return!e.widget_el}).sortBy(function(e){return[e.scope.child._y,e.scope.child._x]}).forEach(function(e){var i=$("<div></div>"),a=e.scope.child,d=!!_.isUndefined(a._x);"Twitter news"===a.name&&i.addClass("grid-floater"),i.html(e.el),e.widget_el=i,t.addWidget(i,a._x,a._y,a._width||4,a._height||4,d),o(r.isFrozen||a._isFrozen,i),i.find(".ui-resizable-handle").css(s.getApplicableWidgetHandleStyles(a,r.dashboard))}),a.on("change",d)}))},!0)},controller:"DashboardCtrl"}}e.$inject=["$q","$compile","dashboardSvc","dashboardCommunicationSvc","c8yTitle"],angular.module("c8y.parts.dashboard2").directive("c8yDashboardGridstack",e)}();
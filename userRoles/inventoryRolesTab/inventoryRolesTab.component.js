"use strict";function _objectSpread(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?Object(arguments[e]):{},t=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(e){_defineProperty(n,e,o[e])})}return n}function _defineProperty(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}!function(){function e(e,n,o,s,r,t,l,i){var c=this;function a(){n.listInventoryRoles(c.user).then(o.getResData).then(function(e){c.assignedRoles=_.keyBy(e.inventoryAssignments,"managedObject")}),n.detail(c.user).then(o.getResData).then(function(e){e.owner?n.listInventoryRoles(e.owner).then(o.getResData).then(function(e){c.ownerAssignedRoles=_.keyBy(e.inventoryAssignments,"managedObject"),_.isEmpty(c.ownerAssignedRoles)&&(c.displayNoOwnerRolesAlert=!0),c.failedToFetchOwnerInventoryRoles=!1}).catch(function(){c.failedToFetchOwnerInventoryRoles=!0}):c.failedToFetchOwnerInventoryRoles=!1})}function u(){a(),l.success(i.getPlural(y(),"Inventory role updated","Inventory roles updated",{}))}function y(){return _.filter(c.assignedRoles,"isModified").length}function d(e){var n="replace"===e.process,o=e.roles,t=_.map(c.assignedRoles);return s.copyUserRoles(o,t,c.user,n).then(a).then(r.successUserRolesCopy)}_.assign(c,{$onChange:function(e){e.user&&a()},onChangeRoles:function(e,n){c.assignedRoles[n]=c.assignedRoles[n]||{},_.assign(c.assignedRoles[n],{managedObject:n,roles:e,isModified:!0}),c.assignedRoles=_objectSpread({},c.assignedRoles)},onSaveInventoryRoles:function(){s.onSaveInventoryRoles(c.user,c.assignedRoles).then(u)},copyRoles:function(){r.copyFromUserDialog(c.user).then(d)},loadAssignedRoles:a,isUnchanged:function(){return 0===y()},helpLink:t.getUserGuideLink(_.get(r.STRINGS,"LINKS.ROLES_INVENTORY")),displayNoOwnerRolesAlert:!1,failedToFetchOwnerInventoryRoles:null}),a()}e.$inject=["$q","c8yUser","c8yBase","c8yUserInventoryRoles","c8yUserRolesUi","c8yDocs","c8yAlert","gettextCatalog"],angular.module("c8y.userRoles").component("c8yUserInventoryRolesTab",{templateUrl:":::PLUGIN_PATH:::/inventoryRolesTab/inventoryRolesTab.html",controllerAs:"vm",controller:e,bindings:{user:"<"}})}();
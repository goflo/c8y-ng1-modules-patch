"use strict";!function(){function e(e,n,t,l,a){var o,r=new l.Bounds,c=[],g={type:"polygon",stroke:!0,weight:1,color:"#2e3974",fillColor:"#2e3974",latlngs:[]},s={center:{},events:{},bounds:r.get(),markers:c,paths:{geofencePath:g}};function i(e){e&&(s.center=_.assign(s.center,{lat:Number(e.lat),lng:Number(e.lon),zoom:17}))}function u(){0<g.latlngs.length&&(r.reset(),_.forEach(g.latlngs,function(e){r.add(e)}),s.bounds=r.get())}function f(){g.latlngs.length=0,c.length=0}function d(e,n){switch(e.name){case"leafletDirectiveMarker.dragstart":o={lat:n.model.lat,lng:n.model.lng,draggable:!0};break;case"leafletDirectiveMarker.dragend":g.latlngs[_.findIndex(g.latlngs,o)]={lat:n.model.lat,lng:n.model.lng,draggable:!0}}}e.gotoAddress=function(e){l.geoCode(e).then(function(e){return e.data[0]||null}).then(i)},e.centerMap=u,e.clearGeofence=f,e.chooseGeofence=function(){n.close(function(e){return _.map(e,function(e){return{lat:e.lat,lng:e.lng}})}(g.latlngs))},e.cancel=n.dismiss,e.map=s,e.$on("leafletDirectiveMap.click",function(e,n){var t={lat:n.leafletEvent.latlng.lat,lng:n.leafletEvent.latlng.lng,draggable:!0};s.markers.push(t),g.latlngs.push(t)}),e.$on("leafletDirectiveMarker.dragend",d),e.$on("leafletDirectiveMarker.dragstart",d),f(),_.forEach(a,function(e){e.draggable=!0,c.push(e),g.latlngs.push(e)}),t(u,0)}e.$inject=["$scope","$uibModalInstance","$timeout","c8yGeo","geofenceLatLngs"],angular.module("c8y.cockpit.map").controller("GeofenceEditCtrl",e)}();
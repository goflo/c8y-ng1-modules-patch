"use strict";!function(){function t(n,t,r,e,a,o,i,c,s,u){var h={getThisMonth:function(){var t=r.monthFilter();return _.unset(t,"dataTo"),g(t)},getLastMonth:function(){return g(r.monthFilter({},1))},getThisDay:function(){return{dateFrom:moment().startOf("day").format("YYYY-MM-DD")}},getTerminalUsage:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&m.cache.delete(t);return m(t)},getUsageTooltip:function(t,e,n){var r=[];if(!_.isUndefined(t)){var o={thisMonthEnd:t.dateTo,thisMonthStart:t.dateFrom};r.push(a.getString("Usage in this month to date ({{thisMonthStart}} - {{thisMonthEnd}})",o))}if(!_.isUndefined(n)){var i={thisMonthEnd:t.dateTo,thisMonthStart:t.dateFrom,lastMonthStart:e.dateFrom,lastMonthEnd:e.dateTo,lastMonthUsage:n};r.push(a.getString("Usage in the last month ({{lastMonthStart}} - {{lastMonthEnd}}): {{lastMonthUsage}}",i))}return r.join("\n")},getTodaysUsageTooltip:function(){return t("Recent data")},processUsageData:function(t,n){var e=t?_.reduce(t,function(t,e){return t+_.get(e,n)},0).toFixed(3):0;return 0<e?e:0},isAdmin:function t(){t.promise||(t.promise=e.hasAnyRole(["ROLE_CONNECTIVITY_ADMIN"]));return t.promise},getProviderSupportedFunctionalities:function t(){t.promise||(t.promise=o.getProviderSupportedFunctionalities().then(function(t){var e,n=t.functionalities;return e=n,_.reduce(e,function(t,e){return t[e]=!0,t},{})}));return t.promise},getCurrentProviderDetails:function t(){t.promise||(t.promise=i.detail());return t.promise},getThisDayDataUsage:function(t,e){2<arguments.length&&void 0!==arguments[2]&&arguments[2]&&d.cache.delete("".concat(t,"_").concat(e));return d(t,e)},shouldShowConnectivityTabInDM:function(t){return s.detailCached(t).then(r.getResData).then(f).then(o.ping).then(o.isConnectivitySubscribed).then(function(){return function(t){return o.getTerminalDetails(t,{},{},{silentError:!0}).catch(function(t){return 400!==t.status&&u.danger(r.getResErrorMessage(t)),n.reject(t)})}(t)}).then(function(){return function(e){return s.detailCached(e).then(r.getResData).then(function(t){return _.get(t,"c8y_Mobile.c8y_IsConnectivity")?n.when():o.getTerminalDetails(e,{},{},{silentError:!0}).then(function(){return _.set(t,"c8y_Mobile.c8y_IsConnectivity",{}),s.save(t)})})}(t)}).then(_.constant(!0)).catch(_.constant(!1))}},d=_.memoize(function(t,e){return o.getTerminalDataUsage(t,{},e)},function(t,e){return"".concat(t,"_").concat(e)}),m=_.memoize(function(t){return o.getTerminalUsage(t,{},{})});return h;function g(t){if(t.dateFrom){var e=t.dateFrom;t.dateFrom=moment(e).format("YYYY-MM-DD"),t.cycleStartDate=moment(e).format("YYYY-MM-DD")}return t.dateTo?t.dateTo=moment(t.dateTo).format("YYYY-MM-DD"):t.dateTo=moment().format("YYYY-MM-DD"),t}function f(t){var e=t;return _.get(e,"c8y_Mobile.iccid")||_.get(e,"c8y_Mobile.msisdn")?n.when():n.reject()}}t.$inject=["$q","gettext","c8yBase","c8yPermissions","gettextCatalog","c8yConnectivity","c8yConnectivitySettings","c8yActions","c8yDevices","c8yAlert"],angular.module("c8y.connectivityV2").factory("connectivityService",t)}();
"use strict";!function(){function t(e,o,r,i,u){var s=this;function a(t){var n=s.selectedInstruction;n&&"message"===n.type&&!n.messageId&&m(n),s.selectedInstruction=t}function t(t){s.simulator.instances=t,d(_.pick(s.simulator,["id","instances"]),!0)}function n(){var t=o.resolve(),n=s.simulatorId||e.deviceId;return n&&(t=r.detail(n).then(c)),t}function c(t){s.simulator=t}function m(t){s.selectedInstruction===t&&(s.selectedInstruction=void 0),_.remove(s.simulator.commandQueue,t),l()}function l(){return d(_.pick(s.simulator,["id","commandQueue"]),!0)}function d(t,n){return a(),r.save(t||s.simulator).then(n?_.identity:i.listing)}function f(){o.all({defaultOps:r.operations(),customOps:o.resolve(s.simulator.c8y_CustomOperations)}).then(function(t){var n=t.defaultOps,e=t.customOps;s.operations=_.flatten([n,_.map(e,function(t){return{fragment:t,name:u("Custom operation"),removable:!0}})])})}function p(t){return r.toggleOperation(s.simulator,t)}_.assign(s,{$onInit:function(){n()},selectInstruction:a,isInstructionSelected:function(t){return t===s.selectedInstruction},remove:m,loadOperations:f,opActive:function(t){return r.supportsOperation(s.simulator,t)},opToggle:p,changeSimulatorName:function(t){return r.save({id:s.simulator.id,name:t})},save:d,addCustomOperation:function(){return i.addCustomOperationDialog().then(function(t){return r.addCustomOperation(s.simulator,t).then(function(){return p(t)}).then(n).then(f)})},removeCustomOperation:function(t){return r.removeOperation(s.simulator,t).then(function(){return r.removeCustomOperation(s.simulator,t)}).then(n).then(f)},editSimulatorInstances:function(){return i.editSimulatorInstances(s.simulator).then(t)},saveCurrentSimulatorCommands:l})}t.$inject=["$routeParams","$q","c8ySimulators","c8ySimulatorsUi","gettext"],angular.module("c8y.simulators").controller("SimulatorDetailController",t)}();
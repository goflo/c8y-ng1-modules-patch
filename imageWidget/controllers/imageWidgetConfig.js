"use strict";function _slicedToArray(e,n){return _arrayWithHoles(e)||_iterableToArrayLimit(e,n)||_unsupportedIterableToArray(e,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function _iterableToArrayLimit(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(t.push(o.value),!n||t.length!==n);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){function e(e,r,n,i,t,a){r.loading=!1;var o,l={},c=[],m="file-to-large",d="invalid-extension",u={};u[m]=t("Selected file is too large."),u[d]=t("Selected file has invalid extension.");var f={c8y_Global:{}};function y(e){l=e.data,r.imageName=l.name,!(!l.type&&l.dataType)&&c.push(l.id),i.downloadAsDataUri(l).then(function(e){r.imageSrc=e})}function s(e){r.loading=!1,l=e.data,c.push(l.id),r.imageName=l.name,r.config.imageBinaryId=l.id}r.maxFileSizeKB=300,r.invalid=function(e){return r.forms.componentForm[e].$invalid},r.getValidationHints=function(e){var t=[];return r.forms.componentForm[e]&&r.forms.componentForm[e].$error&&_.forEach(r.forms.componentForm[e].$error,function(e,n){e&&t.push(a.getString(u[n]))}),t.join(" ")},r.onNewImageSelected=function(e){var n,t=_slicedToArray(e.target.files,1)[0];return t&&0<t.size&&(-1===t.type.indexOf("image/")?r.forms.componentForm.newImageValidationInput.$setValidity(d,!1):300<t.size/1024?r.forms.componentForm.newImageValidationInput.$setValidity(m,!1):(r.forms.componentForm.newImageValidationInput.$setValidity(m,!0),r.forms.componentForm.newImageValidationInput.$setValidity(d,!0),r.loading=!0,n=i.upload(t,f).then(s))),i.readDataUri(t).then(function(e){r.imageSrc=e}),n},r.$on("cancelWidget",function(){r.config.imageBinaryId=o}),r.$on("$destroy",function(){_.forEach(c,function(e){e!==r.config.imageBinaryId&&i.removeBinary(e)})}),_.isUndefined(r.config.imageBinaryId)||(o=r.config.imageBinaryId,i.detail(r.config.imageBinaryId).then(y))}e.$inject=["$q","$scope","c8yBase","c8yBinary","gettext","gettextCatalog"],angular.module("c8y.parts.imageWidget").controller("imageWidgetConfigCtrl",e)}();
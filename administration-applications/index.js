"use strict";!function(){function t(t,i,a,n,c){var e={anyRole:["ROLE_APPLICATION_MANAGEMENT_READ","ROLE_APPLICATION_MANAGEMENT_ADMIN"]};t.addNavigation({parent:{name:c("Applications"),icon:"c8y-atom"},name:c("Own applications"),path:"applications",icon:"c8y-modules",routerLinkExact:!1,priority:3900,showIfPermissions:e}),i.when("/applications",{template:'<c8y-application-list-view base-path="applications"></c8y-application-list-view>'}),i.when("/applications/:applicationId",{template:'<c8y-application-detail base-path="applications"></c8y-application-detail>',icon:"list",name:c("Properties"),priority:1e3}),i.when("/applications/:applicationId",{controller:"permissionsCtrl",templateUrl:":::PLUGIN_PATH:::/views/permissions.html",icon:"check-square-o",name:c("Permissions"),showIf:["$routeParams","c8yBase","c8yApplication",function(t,i,a){return a.detail(t.applicationId).then(i.getResData).then(function(t){return"MICROSERVICE"===t.type})}]}),t.addNavigation({parent:{name:c("Applications"),icon:"c8y-atom"},name:c("Subscribed applications"),path:"subscribedApplications",icon:"window-restore",routerLinkExact:!1,priority:3800,showIfPermissions:e}),i.when("/subscribedApplications",{template:'<c8y-application-list-view base-path="subscribedApplications"></c8y-application-list-view>'}),i.when("/subscribedApplications/:applicationId",{template:'<c8y-application-detail base-path="subscribedApplications"></c8y-application-detail>',icon:"list",name:c("Properties"),priority:1e3}),a.addTitle("/applications/:applicationId",{data:["$q",function(t){return t.when({templateUrl:":::PLUGIN_PATH:::/views/title.html"})}]}),a.addTitle("/subscribedApplications/:applicationId",{data:["$q",function(t){return t.when({templateUrl:":::PLUGIN_PATH:::/views/title.html"})}]}),n.addUrlAction({path:"/applications/:applicationId/*",text:c("Open"),actionBar:!0,position:"right",button:{cls:"default"},icon:"external-link",priority:2e3,showIf:["c8yApplication","$routeParams",function(t,i){return t.canOpenInBrowser(i.applicationId)}],action:["$routeParams","$window","c8yBase","c8yApplication","c8yAlert","gettextCatalog",function(t,a,i,n,e,o){return n.detail(t.applicationId).then(i.getResData).then(function(t){var i=n.getHref(t);/^(?!javascript:).+/.test(i)?a.location.href=i:e.danger(o.getString("Could not open URL: {{url}}.",{url:i}))})}]}),n.addUrlAction({path:"/applications/:applicationId",name:"subscribeAction",text:c("Subscribe"),actionBar:!0,position:"right",button:{cls:"default"},icon:"check-circle-o",priority:2e3,showIf:["c8yTenant","c8yApplication","$q","$routeParams","c8yBase",function(t,i,a,n,e){var o=this;return a.all({app:i.detail(n.applicationId).then(e.getResData),tenant:t.current(!0)}).then(function(t){var i=t.app,a=t.tenant;return _.assign(o,o.getTextAndIcon(o.isApplicationSubscribed(a,n.applicationId))),i.owner.tenant.id===a.name&&"MICROSERVICE"===i.type})}],action:["c8yTenant","c8yApplication","$q","$routeParams","c8yBase",function(e,t,i,o,a){var c=this;i.all({app:t.detail(o.applicationId).then(a.getResData),tenant:e.current(!0)}).then(function(t){var i=t.app,a=t.tenant,n=c.isApplicationSubscribed(a,o.applicationId);return(n?e.removeApplication(a.name,i):e.addApplication(a.name,i)).then(function(){return _.assign(c,c.getTextAndIcon(!n))})})}],isApplicationSubscribed:function(t,i){return t.applications.references.some(function(t){return t.application.id===i})},getTextAndIcon:function(t){return{SUBSCRIBED:{text:c("Unsubscribe"),icon:"minus-circle"},NOT_SUBSCRIBED:{text:c("Subscribe"),icon:"check-circle-o"}}[t?"SUBSCRIBED":"NOT_SUBSCRIBED"]}}),n.addUrlAction({path:"/applications/:applicationId/*",text:c("Delete"),actionBar:!0,position:"right",button:{cls:"danger"},icon:"trash",priority:1e3,showIf:["$routeParams","c8yApplication",function(i,t){return t.getCurrent().then(function(t){return t.id!==i.applicationId})}],action:["$routeParams","$location","c8yBase","c8yApplication","c8yModal","gettextCatalog",function(t,i,a,n,e,o){return n.detail(t.applicationId).then(a.getResData).then(function(t){return e({title:c("Delete application"),body:o.getString('You are about to delete application "{{app | humanizeAppName}}". Do you want to proceed?',{app:t}),status:"danger",labels:{ok:c("Delete")}}).then(angular.bind(n,n.remove,t)).then(function(){i.path("/applications")})})}]}),n.addUrlAction({path:"/applications/:applicationId/archives",text:c("Reactivate"),actionBar:!0,position:"right",button:{cls:"default"},icon:"undo",priority:4e3,showIf:["c8yApplication","$routeParams","c8yBase",function(t,i,a){return t.detail(i.applicationId).then(a.getResData).then(function(t){return"HOSTED"===t.type})}],action:["$routeParams","c8yApplication","c8yAlert",function(t,i,a){i.refreshHostedApp(t.applicationId).then(function(){a.success(c("Application reactivated."))})}]})}t.$inject=["c8yNavigatorProvider","c8yViewsProvider","c8yTitleProvider","c8yActionsProvider","gettext"],angular.module("c8y.parts.applications",[]).config(t)}();